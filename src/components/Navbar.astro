---
import Container from "./Container.astro";
const logoLight = "/icons/logo%20light.png"; // handles space in filename
const logoDark  = "/icons/logo%20dark.png";
---
<nav class="nav" aria-label="Primary">
  <div class="nav-inner">
    <ul class="menu" role="menubar" aria-label="Main">
      <!-- Logo inline with links -->
      <li role="none">
        <a role="menuitem" href="/" aria-label="Home">
          <img id="logoImg" class="logo" src={logoDark} alt="Site logo" />
        </a>
      </li>
      <li role="none"><a role="menuitem" href="/">Home</a></li>
      <li role="none"><a role="menuitem" href="/about">About</a></li>
      <li role="none"><a role="menuitem" href="/research">Research</a></li>
    </ul>

    <button class="theme-toggle" id="themeToggle" aria-label="Toggle light/dark mode" title="Toggle theme">
      <span id="themeIcon" aria-hidden="true"></span>
    </button>
  </div>
</nav>

<script>
  (function(){
    const root = document.documentElement;
    const btn  = document.getElementById('themeToggle');
    const icon = document.getElementById('themeIcon');
    const logo = document.getElementById('logoImg');

    const logos = {
      light: { src: {logoLight} },
      dark:  { src: {logoDark}  }
    };

    function setIcon(theme){
      // Sun for light, Moon for dark
      icon.innerHTML = theme === 'light'
        ? '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zM1 13h3v-2H1v2zm10 10h2v-3h-2v3zm9.83-18.16l-1.79-1.79-1.8 1.79 1.8 1.79 1.79-1.79zM20 13h3v-2h-3v2zM6.76 19.16l-1.8 1.79 1.41 1.41 1.79-1.79-1.4-1.41zM17.24 19.16l1.79 1.79 1.41-1.41-1.79-1.79-1.41 1.41zM12 6a6 6 0 100 12 6 6 0 000-12z"/></svg>'
        : '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M21.75 14.5A9.75 9.75 0 1111.5 2.25a8 8 0 0010.25 12.25z"/></svg>';
    }

    function theme(){
      return root.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
    }

    function apply(theme){
      root.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      setIcon(theme);
      if (logo) logo.src = theme === 'light' ? logos.light.src : logos.dark.src;
    }

    // Init from persisted/system and set correct logo
    const saved = localStorage.getItem('theme');
    const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    apply(saved || (systemDark ? 'dark' : 'light'));

    btn.addEventListener('click', () => {
      apply(theme() === 'light' ? 'dark' : 'light');
    });
  })();
</script>

---
const logoLight = "/icons/logo%20light.png";
const logoDark  = "/icons/logo%20dark.png";
const { pathname } = Astro.url;

const isActive = (p: string) => pathname === p;
---
<nav class="nav" aria-label="Primary">
  <div class="nav-inner">
    <!-- Left: Logo -->
    <div class="nav-left">
      <a href="/" aria-label="Home">
        <img id="logoImg" class="logo" src={logoDark} alt="Logo" />
      </a>
    </div>

    <!-- Center: Menu -->
    <ul class="menu" role="menubar" aria-label="Main">
      <li role="none">
        <a role="menuitem" href="/" class={isActive('/') ? 'active' : ''} aria-current={isActive('/') ? 'page' : undefined}>Home</a>
      </li>
      <li role="none">
        <a role="menuitem" href="/about" class={isActive('/about') ? 'active' : ''} aria-current={isActive('/about') ? 'page' : undefined}>About</a>
      </li>
      <li role="none">
        <a role="menuitem" href="/research" class={isActive('/research') ? 'active' : ''} aria-current={isActive('/research') ? 'page' : undefined}>Research</a>
      </li>
    </ul>

    <!-- Right: Theme toggle -->
    <div class="nav-right">
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle light/dark mode" title="Toggle theme">
        <span id="themeIcon" aria-hidden="true"></span>
      </button>
    </div>
  </div>
</nav>

<script>
  (function(){
    const root = document.documentElement;
    const btn  = document.getElementById('themeToggle');
    const icon = document.getElementById('themeIcon');
    const logo = document.getElementById('logoImg');

    const logos = {
      light: { src: {logoLight} },
      dark:  { src: {logoDark}  }
    };

    function setIcon(theme){
      // Show moon on dark, sun on light
      icon.innerHTML = theme === 'dark'
        ? '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M21.75 14.5A9.75 9.75 0 1111.5 2.25a8 8 0 0010.25 12.25z"/></svg>'
        : '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zM1 13h3v-2H1v2zm10 10h2v-3h-2v3zm9.83-18.16l-1.79-1.79-1.8 1.79 1.8 1.79 1.79-1.79zM20 13h3v-2h-3v2zM6.76 19.16l-1.8 1.79 1.41 1.41 1.79-1.79-1.4-1.41zM17.24 19.16l1.79 1.79 1.41-1.41-1.79-1.79-1.41 1.41zM12 6a6 6 0 100 12 6 6 0 000-12z"/></svg>';
    }

    function getTheme(){
      return root.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
    }

    function apply(theme){
      root.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      setIcon(theme);
      if (logo) logo.src = theme === 'light' ? logos.light.src : logos.dark.src;
    }

    // Initialize from saved/system
    const saved = localStorage.getItem('theme');
    const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    apply(saved || (systemDark ? 'dark' : 'light'));

    btn.addEventListener('click', () => {
      apply(getTheme() === 'light' ? 'dark' : 'light');
    });
  })();
</script>
